
<!doctype html>
<html lang="fr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://ineaweb.github.io/Blog/articles/tips/07.github.ephemeralactionsrunner/">
      
      
        <link rel="prev" href="../06.azuredevops.ephemeralagents/">
      
      
        <link rel="next" href="../08.dockerhub.windowsServerCore2022/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.15">
    
    
      
        <title>GitHub : Vos propres runner à la demande dans votre SI - Philippe MORISSEAU</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e359304.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Poppins";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@morisseauphi" />
  <meta name="twitter:creator" content="@morisseauphi" />
  <meta property="og:title" content="GitHub : Vos propres runner à la demande dans votre SI" />
  <meta name="google-site-verification" content="w_wkWaWiJN0xRkstken01Q7CmA4d_jKTliKb5ilkQlU" />
  
  <meta property="og:image" content="https://ineaweb.github.io/Blog/img/cover/07.ephemeralactionsrunner.png" />
  <meta property="og:description" content="Une solution de bout en bout pour exécuter des GitHub Actions Runner conteneurisés dans votre réseau d'entreprise, ça vous dit ? Vous pourrez ainsi utiliser GitHub pour gérer le déploiement de vos applications et services même dans les zones sécurisées de votre SI." />
  <meta property="og:url" content="https://ineaweb.github.io/Blog/articles/tips/07.github.ephemeralactionsrunner/" />
  <meta name="Description" CONTENT="Une solution de bout en bout pour exécuter des GitHub Actions Runner conteneurisés dans votre réseau d'entreprise, ça vous dit ? Vous pourrez ainsi utiliser GitHub pour gérer le déploiement de vos applications et services même dans les zones sécurisées de votre SI." />
  

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-T8TQW7CYM4"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-T8TQW7CYM4');
  </script>

  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pourquoi-le-faire" class="md-skip">
          Aller au contenu
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
  
  <header class="md-header" data-md-component="header">
    <nav class="md-header__inner md-grid" aria-label="header.title">
      <!--<img src="img/linkedInBandeau.png" />-->
      <a href="../../.." title="Philippe MORISSEAU" class="md-header__button md-logo" aria-label="Philippe MORISSEAU" data-md-component="logo">
        
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

      </a>
      <label class="md-header__button md-icon" for="__drawer">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
      </label>
      <div class="md-header__title" data-md-component="header-title">
        <div class="md-header__ellipsis">
          <div class="md-header__topic">
            <span class="md-ellipsis">
              Philippe MORISSEAU
            </span>
          </div>
          <div class="md-header__topic" data-md-component="header-topic">
            <span class="md-ellipsis">
              
                GitHub : Vos propres runner à la demande dans votre SI
              
            </span>
          </div>
        </div>
      </div>
      
      
        <div class="md-header__option">
          <div class="md-select">
            
            <button class="md-header__button md-icon" aria-label="select.language.title">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
            </button>
            <div class="md-select__inner">
              <ul class="md-select__list">
                
                  <li class="md-select__item">
                    <a href="../../.." hreflang="fr" class="md-select__link">
                      French
                    </a>
                  </li>
                  
                  <li class="md-select__item">
                    <a href="../../../en" hreflang="en" class="md-select__link">
                      English
                    </a>
                  </li>
                  
              </ul>
            </div>
          </div>
        </div>
      
      
      
    </nav>
    
  </header>

    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Philippe MORISSEAU" class="md-nav__button md-logo" aria-label="Philippe MORISSEAU" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Philippe MORISSEAU
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    French
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            French
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Accueil
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" checked>
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Articles
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            Articles
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2_1" >
        
          
          <label class="md-nav__link" for="__nav_1_2_1" id="__nav_1_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    A short story about the big Azure cloud
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2_1">
            <span class="md-nav__icon md-icon"></span>
            A short story about the big Azure cloud
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assatbac/ep01/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Private Endpoint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assatbac/ep02/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Private Endpoint VS Vnet Integration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assatbac/ep03/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SPN, SMI et UMI. Mais c'est quoi ces trucs ?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../assatbac/ep04/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cosmos DB, c'est comme l'orbe de Morag
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2_2" >
        
          
          <label class="md-nav__link" for="__nav_1_2_2" id="__nav_1_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Révision du soir
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2_2">
            <span class="md-nav__icon md-icon"></span>
            Révision du soir
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../classroom/01.azureClassroom.VnetEndpointFirewall/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Private Endpoint, Service Endpoint, Dedicated Service, Service Tags & Firewall
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../classroom/02.azureClassroom.batch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Batch, le mal-aimé
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2_3" >
        
          
          <label class="md-nav__link" for="__nav_1_2_3" id="__nav_1_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Azure, Les exceptions qui font mal !
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2_3">
            <span class="md-nav__icon md-icon"></span>
            Azure, Les exceptions qui font mal !
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../exceptions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../exceptions/01.azureException.acrAndAciInYourVnet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapitre 1 : Azure Container Registry et Azure Container Instance dans votre Vnet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../exceptions/02.azureException.aciWindowsWithVnet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapite 2 : Azure Container Instance et Windows dans votre Vnet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../exceptions/03.azureException.firewallAndRegion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapitre 3 : Les firewall et les régions Azure
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2_4" >
        
          
          <label class="md-nav__link" for="__nav_1_2_4" id="__nav_1_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Au secours, Le DevOps part en vrille !
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2_4">
            <span class="md-nav__icon md-icon"></span>
            Au secours, Le DevOps part en vrille !
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/vrille/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2_4_2" >
        
          
          <label class="md-nav__link" for="__nav_1_2_4_2" id="__nav_1_2_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Partie 1 : Pourquoi arrive-t-on aux limites du DevOps ?
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_1_2_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2_4_2">
            <span class="md-nav__icon md-icon"></span>
            Partie 1 : Pourquoi arrive-t-on aux limites du DevOps ?
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/vrille/01.pourquoi.agilite/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapitre 1 : L'agilité
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/vrille/02.pourquoi.devops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapitre 2 : Le DevOps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/vrille/03.pourquoi.entropie/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapitre 3 : L'entropie
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2_4_3" >
        
          
          <label class="md-nav__link" for="__nav_1_2_4_3" id="__nav_1_2_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Partie 2 : Comment passe-t-on au-delà des limites ?
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_1_2_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2_4_3">
            <span class="md-nav__icon md-icon"></span>
            Partie 2 : Comment passe-t-on au-delà des limites ?
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/vrille/04.comment.machineetat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapitre 1 : La machine à état
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/vrille/05.comment.build/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapitre 2 : Le build
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/vrille/06.comment.deploy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapitre 3 : Le déploiement
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/vrille/07.lapreuve/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C'est possible, la preuve !
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2_5" >
        
          
          <label class="md-nav__link" for="__nav_1_2_5" id="__nav_1_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Adopter une démarche GitOps
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2_5">
            <span class="md-nav__icon md-icon"></span>
            Adopter une démarche GitOps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/gitops/01.gitops.AzureAppConfiguration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Adopter une démarche GitOps grâce à Azure App Configuration (Partie 1)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/gitops/02.gitops.AzureAppConfiguration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Adopter une démarche GitOps grâce à Azure App Configuration (Partie 2)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/gitops/03.gitops.AzureAppConfiguration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Adopter une démarche GitOps grâce à Azure App Configuration (Partie 3)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2_6" >
        
          
          <label class="md-nav__link" for="__nav_1_2_6" id="__nav_1_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Le monde fantastique de Lemniscat
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2_6">
            <span class="md-nav__icon md-icon"></span>
            Le monde fantastique de Lemniscat
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/lemniscat/01.lemniscat.microsoftfabric/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Permettre l'adoption de Fabric grâce à Lemniscat (Partie 1)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2_7" checked>
        
          
          <label class="md-nav__link" for="__nav_1_2_7" id="__nav_1_2_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tips & tricks
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_2_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_2_7">
            <span class="md-nav__icon md-icon"></span>
            Tips & tricks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01.finops.ftpslowcost/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L'astuce FinOps : Un serveur FTPS Low Cost
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02.cosmosdb.waiting_partialupdate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CosmosDB : En attendant le partial update
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03.cosmosdb.calculatedPartitionKey/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CosmosDB : Une clé de partition calculée !
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04.sonarqube.managed/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Déployer Sonarqube sur des services managés Azure.
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05.azuredevops.extension.agentless/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure DevOps : Créer sa propre task agentless
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06.azuredevops.ephemeralagents/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure DevOps : Vos propres agents à la demande dans votre SI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    GitHub : Vos propres runner à la demande dans votre SI
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    GitHub : Vos propres runner à la demande dans votre SI
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pourquoi-le-faire" class="md-nav__link">
    <span class="md-ellipsis">
      Pourquoi le faire ?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#larchitecture" class="md-nav__link">
    <span class="md-ellipsis">
      L'architecture
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linfrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      L'infrastructure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="L'infrastructure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lauto-scale" class="md-nav__link">
    <span class="md-ellipsis">
      L'auto-scale
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#les-limitations" class="md-nav__link">
    <span class="md-ellipsis">
      Les limitations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conteneuriser-votre-actions-runner" class="md-nav__link">
    <span class="md-ellipsis">
      Conteneuriser votre actions runner
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#une-azure-function-pour-piloter-azure-batch" class="md-nav__link">
    <span class="md-ellipsis">
      Une Azure function pour piloter Azure Batch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lintegration-avec-github" class="md-nav__link">
    <span class="md-ellipsis">
      L'intégration avec GitHub
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      Références
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remerciements" class="md-nav__link">
    <span class="md-ellipsis">
      Remerciements
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../08.dockerhub.windowsServerCore2022/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dockerhub : Votre Actions Runner et votre Azure DevOps Agent sous Windows Server Core 2022
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../09.azurefunction.limitlogs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L'astuce FinOps : Limiter la verbosité de vos Azure Function
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10.dockerhub.ubuntu22.04/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Votre agent Azure DevOps et votre runner Github avec Jammy la méduse.
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A Propos
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    English
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            English
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Articles
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Articles
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_2_1" id="__nav_2_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    A short story about the big Azure cloud
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_1">
            <span class="md-nav__icon md-icon"></span>
            A short story about the big Azure cloud
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/assatbac/ep01/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Private Endpoint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/assatbac/ep02/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Private Endpoint VS Vnet Integration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/assatbac/ep03/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SPN, SMI et UMI. But what are these things?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/assatbac/ep04/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cosmos DB, it's like Morag's orb
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2_2" id="__nav_2_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Back to school
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            Back to school
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/classroom/01.azureClassroom.VnetEndpointFirewall/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Private Endpoint, Service Endpoint, Dedicated Service, Service Tags & Firewall
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/classroom/02.azureClassroom.batch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Batch, le mal-aimé
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_2_3" id="__nav_2_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Azure, Exceptions that hurt!
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_3">
            <span class="md-nav__icon md-icon"></span>
            Azure, Exceptions that hurt!
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/exceptions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/exceptions/01.azureException.acrAndAciInYourVnet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapitre 1 : Azure Container Registry et Azure Container Instance dans votre Vnet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/exceptions/02.azureException.aciWindowsWithVnet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapite 2 : Azure Container Instance et Windows dans votre Vnet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/exceptions/03.azureException.firewallAndRegion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapitre 3 : Les firewall et les régions Azure
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_2_4" id="__nav_2_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Help, DevOps is going off road!
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_4">
            <span class="md-nav__icon md-icon"></span>
            Help, DevOps is going off road!
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/devops/vrille/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_4_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2_4_2" id="__nav_2_2_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Part 1: Why are we reaching the limits of DevOps?
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_4_2">
            <span class="md-nav__icon md-icon"></span>
            Part 1: Why are we reaching the limits of DevOps?
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/devops/vrille/01.pourquoi.agilite/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapitre 1 : L'agilité
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/devops/vrille/02.pourquoi.devops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapitre 2 : Le DevOps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/devops/vrille/03.pourquoi.entropie/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapitre 3 : L'entropie
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_4_3" >
        
          
          <label class="md-nav__link" for="__nav_2_2_4_3" id="__nav_2_2_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Part 2: How do we go beyond the limits?
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_4_3">
            <span class="md-nav__icon md-icon"></span>
            Part 2: How do we go beyond the limits?
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/devops/vrille/04.comment.machineetat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapitre 1 : La machine à état
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/devops/vrille/05.comment.build/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapitre 2 : Le build
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/devops/vrille/06.comment.deploy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapitre 3 : Le déploiement
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/devops/vrille/07.lapreuve/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    It is possible, the proof!
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_2_5" id="__nav_2_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Adopt a GitOps approach
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_5">
            <span class="md-nav__icon md-icon"></span>
            Adopt a GitOps approach
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/devops/gitops/01.gitops.AzureAppConfiguration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Adopt a GitOps approach with Azure App Configuration (Part 2)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/devops/gitops/02.gitops.AzureAppConfiguration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Adopt a GitOps approach with Azure App Configuration (Part 2)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/devops/gitops/03.gitops.AzureAppConfiguration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Adopt a GitOps approach with Azure App Configuration (Part 3)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_2_6" id="__nav_2_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    The fantastic world of Lemniscat
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_6">
            <span class="md-nav__icon md-icon"></span>
            The fantastic world of Lemniscat
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/devops/lemniscat/01.lemniscat.microsoftfabric/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Enabling Adoption of Fabric with Lemniscat (Part 1)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_2_7" id="__nav_2_2_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tips & tricks
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_7">
            <span class="md-nav__icon md-icon"></span>
            Tips & tricks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/tips/01.finops.ftpslowcost/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L'astuce FinOps : Un serveur FTPS Low Cost
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/tips/02.cosmosdb.waiting_partialupdate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CosmosDB : En attendant le partial update
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/tips/03.cosmosdb.calculatedPartitionKey/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CosmosDB : Une clé de partition calculée !
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/tips/04.sonarqube.managed/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Déployer Sonarqube sur des services managés Azure.
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/tips/05.azuredevops.extension.agentless/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure DevOps : Créer sa propre task agentless
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/tips/06.azuredevops.ephemeralagents/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure DevOps: Your own on-demand agents in your corporate network
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/tips/07.github.ephemeralactionsrunner/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitHub : Your own on-demand runner in your corporate network
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/tips/08.dockerhub.windowsServerCore2022/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dockerhub: Your Actions Runner and Azure DevOps Agent on Windows Server Core 2022
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/tips/09.azurefunction.limitlogs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The FinOps tip: Limit the verbosity of your Azure Functions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/articles/tips/10.dockerhub.ubuntu22.04/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Your Azure DevOps Agent and Github Runner with Jammy Jellyfish.
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../en/about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pourquoi-le-faire" class="md-nav__link">
    <span class="md-ellipsis">
      Pourquoi le faire ?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#larchitecture" class="md-nav__link">
    <span class="md-ellipsis">
      L'architecture
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linfrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      L'infrastructure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="L'infrastructure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lauto-scale" class="md-nav__link">
    <span class="md-ellipsis">
      L'auto-scale
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#les-limitations" class="md-nav__link">
    <span class="md-ellipsis">
      Les limitations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conteneuriser-votre-actions-runner" class="md-nav__link">
    <span class="md-ellipsis">
      Conteneuriser votre actions runner
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#une-azure-function-pour-piloter-azure-batch" class="md-nav__link">
    <span class="md-ellipsis">
      Une Azure function pour piloter Azure Batch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lintegration-avec-github" class="md-nav__link">
    <span class="md-ellipsis">
      L'intégration avec GitHub
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      Références
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remerciements" class="md-nav__link">
    <span class="md-ellipsis">
      Remerciements
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>GitHub : Vos propres runner à la demande dans votre SI</h1>

<p>Une solution de bout en bout pour exécuter des <strong>GitHub Actions Runner</strong> conteneurisés dans votre réseau d'entreprise, ça vous dit ? Vous pourrez ainsi utiliser <strong>GitHub</strong> pour gérer le déploiement de vos applications et services même dans les zones sécurisées de votre SI. </p>
<p>Dans un précédent article je vous ai proposé de mettre en place une solution vous permettant de provisionner à la demande vos agents <strong>Azure DevOps</strong> (cf. <a href="../06.azuredevops.ephemeralagents/">Azure DevOps : Vos propres agents à la demande dans votre SI</a>). Je vous propose de faire la même chose mais avec <strong>GitHub</strong>. </p>
<h2 id="pourquoi-le-faire">Pourquoi le faire ?</h2>
<p>Pour les mêmes raisons qu'avec <a href="../06.azuredevops.ephemeralagents/">Azure DevOps Services</a>, à savoir :</p>
<ul>
<li>Si vous souhaitez utiliser <strong>GitHub Actions</strong> pour déployer vos applications et services dans votre SI d'entreprise isolé d'un point de vue réseau.</li>
<li>Si vous souhaitez utiliser des conteneurs pour vos opérations de <strong>build</strong> et/ou de déploiement afin d'éviter les effets de bord liés aux précédentes exécutions de pipeline <strong>CI/CD</strong>. </li>
<li>Si vous souhaitez réduire le temps de <strong>build</strong> et de déploiement de vos pipelines en préinstallant vos <strong>frameworks</strong> et outils <strong>legacy</strong> sur vos agents.</li>
</ul>
<h2 id="larchitecture">L'architecture</h2>
<p>Je vous propose d'orchestrer vos <strong>GitHub Actions Runner</strong> avec <strong>Azure Batch</strong>. L'ensemble de l'architecture sera donc sur <strong>Azure</strong>. Bien entendu, c'est une proposition, il est certain que vous pouvez réaliser une architecture équivalente sur un autre hébergeur <strong>cloud</strong> ou sur votre <strong>cloud</strong> privé.</p>
<p><img alt="architecture" src="../../../img/tips.07.schema-EphemeralActionsRunner.svg" /></p>
<p>Concrètement voici le séquencement qui va se produire pour la mise à disposition d'un agent éphémère :</p>
<ol>
<li><strong>GitHub</strong> appelle la fonction <strong>ProvideActionsRunner</strong> pour demander un <strong>runner</strong> éphémère,</li>
<li>Pour chaque appel, l'<strong>Azure Function</strong> crée une tâche dans <strong>Azure Batch Account</strong>,</li>
<li>L'<strong>Azure Batch Account</strong> traite les tâches et affecte la tâche au bon <strong>pool</strong> de nœuds,</li>
<li>Le <strong>pool</strong> de nœuds instancie un conteneur à partir de l'image présente dans l'<strong>Azure Container Registry</strong>,</li>
<li>Une fois le conteneur instancié et démarré, celui-ci s'enregistre auprès de <strong>GitHub</strong> pour faire savoir qu'il est disponible. <strong>GitHub</strong> lui affecte alors un <strong>job</strong> en attente. </li>
<li>Le <strong>job GitHub</strong> s'exécute dans le <strong>Virtual Network A</strong> et peut communiquer avec le réseau <strong>On Premise</strong>.</li>
</ol>
<p>On constate que le service <strong>Azure Batch</strong> (et ses <strong>pools</strong>) ainsi qu'<strong>Azure Container Registry</strong> sont complètement isolés d'un point de vue réseau. Seule l'<strong>Azure Function</strong> est accessible publiquement. Cette dernière a cependant une règle firewall limitant les appels aux plages d'IP publiques de <strong>GitHub</strong>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>GitHub</strong> met à disposition les plages d'<strong>IP</strong> de ses services à partir de cette <a href="https://api.github.com/meta">api</a></p>
</div>
<p>Il ne reste donc plus qu'à déployer notre infrastructure sur <strong>Azure</strong>.</p>
<h2 id="linfrastructure">L'infrastructure</h2>
<p>J'ai mis à jour l'infrastructure préalablement mise en place pour <strong>Azure DevOps Service</strong> avec les quelques spécificités de <strong>GitHub</strong>. 
Vous trouverez ci-dessous le <strong>template ARM</strong> permettant de déployer rapidement l'infrastructure pour <strong>GitHub</strong> et pour <strong>Azure DevOps</strong>).  </p>
<p><a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FIneaweb%2Fazure.ephemeralagentrunner%2Fmain%2Farm%2Fazuredeploy.json"><img alt="Deploy To Azure" src="https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/1-CONTRIBUTION-GUIDE/images/deploytoazure.svg?sanitize=true" /></a>
<a href="http://armviz.io/#/?load=https%3A%2F%2Fraw.githubusercontent.com%2FIneaweb%2Fazure.ephemeralagentrunner%2Fmain%2Farm%2Fazuredeploy.json"><img alt="Visualize" src="https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/1-CONTRIBUTION-GUIDE/images/visualizebutton.svg?sanitize=true" /></a></p>
<p>Ce <strong>template</strong> d'infra. met à disposition 2 <strong>pools</strong> de <strong>nodes</strong> : un <strong>pool</strong> pour les <strong>Actions Runner</strong> sur <strong>Windows</strong> et un autre pour les <strong>Actions Runner</strong> sur <strong>Linux</strong>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Etant donné que les conteneurs <strong>Windows</strong> ne peuvent tourner que sur des <strong>OS Windows</strong>, nous n'avons pas d'autres choix que de provisionner des pools avec des <strong>OS</strong> distincts.</p>
</div>
<h3 id="lauto-scale">L'auto-scale</h3>
<p><strong>Azure Batch</strong> propose un système d'<strong>auto-scale</strong> des <strong>nodes</strong> d'un <strong>pool</strong>. Dans notre cas, nous allons l'utiliser pour éviter de laisser tourner des <strong>VM</strong> sur <strong>Azure</strong> pendant plusieurs heures sans opération de <strong>build</strong> ou de déploiement.
Pour chacun de ces <strong>pools</strong>, j'ai donc rajouté le script d'<strong>auto-scale</strong> ci-dessous :</p>
<div class="highlight"><pre><span></span><code><span class="nv">$nbTaskPerNodes</span> <span class="p">=</span> <span class="nv">$TaskSlotsPerNode</span><span class="p">;</span>
<span class="nv">$currentNodes</span> <span class="p">=</span> <span class="nv">$TargetLowPriorityNodes</span><span class="p">;</span>
<span class="nv">$nbPending5min</span> <span class="p">=</span> <span class="nv">$PendingTasks</span><span class="p">.</span><span class="n">GetSamplePercent</span><span class="p">(</span><span class="n">TimeInterval_Minute</span> <span class="p">*</span> <span class="n">5</span><span class="p">)</span> <span class="p">&lt;</span> <span class="n">70</span> <span class="p">?</span> <span class="n">max</span><span class="p">(</span><span class="nv">$PendingTasks</span><span class="p">.</span><span class="n">GetSample</span><span class="p">(</span><span class="n">1</span><span class="p">))</span> <span class="p">:</span> <span class="n">max</span><span class="p">(</span><span class="nv">$PendingTasks</span><span class="p">.</span><span class="n">GetSample</span><span class="p">(</span><span class="n">TimeInterval_Minute</span> <span class="p">*</span> <span class="n">5</span><span class="p">));</span>
<span class="nv">$nbPending60min</span> <span class="p">=</span> <span class="nv">$PendingTasks</span><span class="p">.</span><span class="n">GetSamplePercent</span><span class="p">(</span><span class="n">TimeInterval_Minute</span> <span class="p">*</span> <span class="n">60</span><span class="p">)</span> <span class="p">&lt;</span> <span class="n">70</span> <span class="p">?</span> <span class="n">1000</span> <span class="p">:</span> <span class="n">max</span><span class="p">(</span><span class="nv">$PendingTasks</span><span class="p">.</span><span class="n">GetSample</span><span class="p">(</span><span class="n">TimeInterval_Minute</span> <span class="p">*</span> <span class="n">60</span><span class="p">));</span>
<span class="nv">$totalLowPriorityNodes</span> <span class="p">=</span> <span class="nv">$nbPending5min</span> <span class="p">&gt;</span> <span class="n">max</span><span class="p">(</span><span class="n">0</span><span class="p">,</span> <span class="nv">$TaskSlotsPerNode</span> <span class="p">*</span> <span class="nv">$currentNodes</span><span class="p">)</span> <span class="p">?</span> <span class="nv">$currentNodes</span> <span class="p">+</span> <span class="n">1</span> <span class="p">:</span> <span class="nv">$currentNodes</span><span class="p">;</span>
<span class="nv">$totalLowPriorityNodes</span> <span class="p">=</span> <span class="nv">$nbPending60min</span> <span class="p">&lt;=</span> <span class="nv">$TaskSlotsPerNode</span> <span class="p">*</span> <span class="n">max</span><span class="p">(</span><span class="n">0</span><span class="p">,</span> <span class="nv">$currentNodes</span> <span class="p">-</span> <span class="n">1</span><span class="p">)</span>  <span class="p">?</span> <span class="nv">$currentNodes</span> <span class="p">-</span> <span class="n">1</span> <span class="p">:</span> <span class="nv">$totalLowPriorityNodes</span><span class="p">;</span>
<span class="nv">$totalLowPriorityNodes</span> <span class="p">=</span> <span class="n">min</span><span class="p">(</span><span class="n">4</span><span class="p">,</span> <span class="n">max</span><span class="p">(</span><span class="nv">$totalLowPriorityNodes</span><span class="p">,</span> <span class="n">0</span><span class="p">));</span>
<span class="nv">$TargetLowPriorityNodes</span> <span class="p">=</span> <span class="nv">$totalLowPriorityNodes</span><span class="p">;</span>
<span class="nv">$NodeDeallocationOption</span> <span class="p">=</span> <span class="n">taskcompletion</span><span class="p">;</span>
</code></pre></div>
<p>Ce script va évaluer le nombre de tâches en cours ou en attente :</p>
<ul>
<li>Si celui-ci est supérieur au nombre de nœuds multiplié par le nombre de tâches parallèles, un nouveau nœud sera ajouté.</li>
<li>Si celui-ci est inférieur au nombre de nœuds - 1 multiplié par le nombre de tâches parallèles, un nœud sera libéré.</li>
</ul>
<p>Le <strong>Scale-Out</strong> (ajout d'un nœud) est évalué sur les 5 dernières minutes afin d'être le plus réactif possible en cas de hausse du nombre de tâches.
Le <strong>Scale-In</strong> (suppression d'un nœud) est évalué sur la dernière heure afin de pouvoir gérer les baisses ponctuelles de tâches.</p>
<p>Voici un exemple de ce que pourrait donner l'activité sur une journée :</p>
<p><img alt="ScaleIn-ScaleOut" src="../../../img/tips.06.ScaleInOut-EphemeralAgents.png" /></p>
<h3 id="les-limitations">Les limitations</h3>
<p>Cependant, il faut savoir qu'il y a quelques petites limitations :</p>
<ol>
<li>Bien que vous puissiez déployer vos <strong>pools Azure Batch</strong> avec <strong>ARM</strong>, il n'est pas possible d'incrémenter l'infrastructure du <strong>pool</strong>. Autrement dit, vous ne pouvez pas modifier un <strong>pool</strong> existant. Et, c'est même pire puisque vous aurez une erreur si votre <strong>pool</strong> existe déjà au moment de l'exécution de votre <strong>template ARM</strong>. Pour compenser cette limitation, j'ai ajouté 2 paramètres "create_WindowsBatchPool" et "create_UbuntuBatchPool".</li>
<li>Lors de la création de votre <strong>container registry</strong>, celui-ci ne contient aucune image. Il faudra ainsi prévoir l'importation des images de vos <strong>Actions Runner</strong>. </li>
</ol>
<p>Pour cette seconde limitation, je vous propose d'étudier la conteneurisation de notre <strong>Actions Runner</strong>. </p>
<h2 id="conteneuriser-votre-actions-runner">Conteneuriser votre actions runner</h2>
<p>Je suis reparti de mon travail pour la conteneurisation des agents <strong>Azure DevOps</strong> pour l'appliquer aux <strong>Actions Runner</strong>.</p>
<p>Vous pouvez trouver mes adaptations sur mon repository <a href="https://github.com/Ineaweb/docker-github-actions-runner">GitHub</a>, et les images générées sur <a href="https://hub.docker.com/repository/docker/pmorisseau/githubactions-runner">dockerhub</a>.</p>
<p>Il ne reste plus qu'à importer les images de <strong>dockerhub</strong> vers votre <strong>Azure Container Registry</strong> avec les commandes <strong>Azure CLI</strong> suivantes :</p>
<div class="highlight"><pre><span></span><code>    az acr import -n <span class="o">[</span>YOUR_ACR_NAME<span class="o">]</span> --source docker.io/pmorisseau/githubactions-runner:ubuntu-20.04-actionsrunner -t githubactions-runner:ubuntu-20.04-actionsrunner
    az acr import -n <span class="o">[</span>YOUR_ACR_NAME<span class="o">]</span> --source docker.io/pmorisseau/githubactions-runner:ubuntu-20.04-actionsrunner -t githubactions-runner:ubuntu-18.04-actionsrunner
    az acr import -n <span class="o">[</span>YOUR_ACR_NAME<span class="o">]</span> --source docker.io/pmorisseau/githubactions-runner:windows-core-ltsc2019-actionsrunner -t githubactions-runner:windows-core-ltsc2019-actionsrunner
</code></pre></div>
<p>Maintenant, passons à la programmation de la fonction qui va générer les tâches dans <strong>Azure Batch</strong>.</p>
<h2 id="une-azure-function-pour-piloter-azure-batch">Une Azure function pour piloter Azure Batch</h2>
<p>Notre objectif est de permettre la création d'une tâche exécutant notre image conteneurisée dans <strong>Azure Batch</strong> via l'appel <strong>HTTPS</strong> d'une fonction <strong>Azure</strong>.</p>
<p>Pour rappel, une tâche doit s'exécuter dans un <strong>job</strong>. Donc si le <strong>job</strong> n'existe pas, il faudra le créer.
Notre <strong>job</strong> va permettre aussi de définir les variables d'environnements de notre agent conteneurisé. Dans notre cas, nous devons définir comme variables d'environnement :</p>
<ul>
<li>L'url de l'organisation <strong>GitHub</strong> ou l'url du <strong>repo</strong> personnel,</li>
<li>Le <strong>token</strong> pour permettre à notre agent de s'enregistrer,</li>
<li>Les <strong>tags</strong> qui permettront d'affecter le bon <strong>runner</strong> au bon <strong>job GitHub</strong>,</li>
<li>Le top indiquant si l'agent ne doit exécuter qu'un seul <strong>job GitHub Actions</strong>.</li>
</ul>
<p>Nous allons utiliser le .NET 6.0 pour programmer notre <strong>Azure Function</strong>.
Vous trouverez <a href="https://github.com/Ineaweb/azure.ephemeralagentrunner/tree/main/src/AzFunction.BatchOrchestrator">ici</a> le code source amélioré pour gérer à la fois <strong>Azure Devops</strong> et <strong>GitHub</strong>.</p>
<p>Sur <strong>GitHub</strong> le jeton permettant d'enregistrer notre <strong>runner</strong> a une validité d'une heure. Il faut donc prévoir de demander systématiquement un nouveau jeton pour chaque <strong>job</strong>. Pour cela, il faut appeler l'api <strong>GitHub</strong>. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>GitHub</strong> fournit une documentation d'<strong>api</strong> complète permettant de récupérer ce <strong>token</strong> pour :</p>
<ul>
<li><a href="https://docs.github.com/en/rest/reference/actions#create-a-registration-token-for-an-enterprise">GitHub enterprise</a></li>
<li><a href="https://docs.github.com/en/rest/reference/actions#create-a-registration-token-for-an-organization">GitHub organization</a></li>
<li><a href="https://docs.github.com/en/rest/reference/actions#create-a-registration-token-for-a-repository">GitHub repository</a></li>
</ul>
</div>
<p>Mais pour pouvoir appeler l'api, il faut être authentifié ! 
Il existe 3 méthodes :</p>
<ul>
<li><strong>GitHub App</strong> : Vous permet de créer une application permettant à vos utilisateurs d'accéder au travers de celle-ci aux services de <strong>GitHub</strong>.</li>
<li><strong>OAuth App</strong> : Vous permet de créer une application permettant d'accéder à la place de l'utilisateur aux services de <strong>GitHub</strong>.</li>
<li><strong>Personal Access Token</strong> : Vous permet d'accéder aux services de <strong>GitHub</strong> en se faisant passer pour vous.</li>
</ul>
<p>Dans mon cas, j'ai opté pour la solution la plus simple à mettre en œuvre : le <strong>Personal Access Token</strong>. Mais je vous recommande fortement d'opter pour l'<strong>OAuth App</strong>.</p>
<p>Pour créer votre <strong>Personal Access Token</strong> :</p>
<ol>
<li>Cliquez sur <strong>Settings</strong> dans l'onglet de votre compte,</li>
<li>Cliquez sur <strong>Developer settings</strong> et ensuite <strong>Personal access tokens</strong>,</li>
<li>Puis <strong>Generate new token</strong></li>
<li>Saisissez un libellé et une durée de validité.</li>
<li>Sélectionnez les scopes. Dans notre cas, si vous souhaitez créer des <strong>runners</strong> au niveau de votre organisation il faudra cocher <code>admin:org</code>. Et si vous souhaitez créer des <strong>runners</strong> au niveau de vos <strong>repos</strong>, il faudra cocher <code>repo</code>.
    <img alt="scopes" src="../../../img/tips.07.personalaccesstoken.png" /></li>
<li>Enfin cliquez sur <strong>Generate token</strong>. Votre <strong>token</strong> s'affiche. Sauvegardez-le puisqu'il ne sera plus visible ensuite !</li>
</ol>
<p>Voici donc la configuration nécessaire pour l'<strong>Azure Function</strong> :</p>
<table>
<thead>
<tr>
<th>Nom</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>BatchAccountUrl</td>
<td><strong>Url</strong> du service <strong>Azure Batch</strong></td>
</tr>
<tr>
<td>BatchAccountName</td>
<td>Nom du service <strong>Azure Batch</strong></td>
</tr>
<tr>
<td>BatchAccountKey</td>
<td>Clé d'accès au service <strong>Azure Batch</strong></td>
</tr>
<tr>
<td>ContainerRegistryServer</td>
<td>Nom complet du service <strong>Azure Container Registry</strong></td>
</tr>
<tr>
<td>UbuntuPool</td>
<td>Nom du pool contenant les agents s'exécutant sur <strong>Ubuntu</strong></td>
</tr>
<tr>
<td>WindowsPool</td>
<td>Nom du pool contenant les agents s'exécutant sur <strong>Windows</strong></td>
</tr>
<tr>
<td>GithubToken</td>
<td><strong>Personal access token</strong> permettant de demander un <strong>token</strong> pour l'enregistrement du <strong>runner</strong></td>
</tr>
</tbody>
</table>
<h2 id="lintegration-avec-github">L'intégration avec GitHub</h2>
<p>Maintenant que nous avons notre solution opérationnelle sur <strong>Azure</strong>, il faut permettre à nos <strong>workflows GitHub</strong> de demander un <strong>runner</strong> et d'utiliser celui-ci lorsqu'il est disponible.</p>
<p>Ce qui est super avec <strong>GitHub</strong> contrairement à <strong>Azure DevOps Services</strong>, c'est la multitude de <strong>webhooks</strong>.
<strong>GitHub</strong> propose notamment un <strong>webhook</strong> pour les <strong>jobs</strong>.  </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>GitHub</strong> fournit une documentation de <strong>webhook</strong> et de <strong>payload</strong> complète <a href="https://docs.github.com/en/developers/webhooks-and-events/webhooks/webhook-events-and-payloads">ici</a></p>
</div>
<p>Dans notre cas, nous allons souscrire notre <strong>Azure function</strong> aux <strong>webhooks</strong> de <strong>GitHub</strong>.</p>
<p>Pour cela :</p>
<ol>
<li>dans les <strong>Settings</strong> de votre <strong>repo</strong> ou de votre <strong>organization</strong> cliquez sur <strong>Webhooks</strong>,</li>
<li>cliquez sur <strong>Add Webhooks</strong>,</li>
<li>dans <strong>Payload URL</strong> saisissez l'url complète de votre <strong>function</strong> : https://<code>[VotreAzureFunction]</code>.azurewebsites.net/api/ProvideActionsRunner?code=<code>[VotreSecret]</code></li>
<li>dans <strong>Content Type</strong> sélectionnez <code>application/json</code></li>
<li>cochez <code>Let me select individual events.</code></li>
<li>décochez <code>Pushes</code></li>
<li>cochez <code>Workflow jobs</code></li>
<li>Enfin cliquez sur <strong>Add webhooks</strong></li>
</ol>
<p>Maintenant à chaque fois que vous aurez un nouveau <strong>job GitHub</strong>, votre <strong>Azure function</strong> recevra une notification pour créer un <strong>runner</strong>.</p>
<p>Il ne reste plus qu'à créer le <strong>workflow GitHub</strong> !</p>
<p>Pour indiquer que vous souhaitez un agent <strong>self-hosted</strong> vous devez préciser pour vos jobs : <code>runs-on: [self-hosted]</code>.
Et pour indiquer le type d'OS que vous souhaitez utiliser, il faudra ajouter un autre label : <code>ubuntu-18.04</code>, <code>ubuntu-latest</code> ou <code>windows-latest</code>.</p>
<p>Par exemple :</p>
<div class="highlight"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Test Agent</span><span class="w"></span>
<span class="nt">on</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span><span class="w"></span>

<span class="nt">jobs</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">use-selfhosted-ubuntu1804</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">self-hosted</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ubuntu-18.04</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v2</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Fetch release version</span><span class="w"></span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">          </span><span class="no">echo &quot;Hello world !&quot;</span><span class="w"></span>

<span class="w">  </span><span class="nt">use-selfhosted-ubuntu2004</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">self-hosted</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ubuntu-latest</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v2</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Fetch release version</span><span class="w"></span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">          </span><span class="no">echo &quot;Hello world !&quot;</span><span class="w"></span>

<span class="w">  </span><span class="nt">use-selfhosted-windows</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">self-hosted</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">windows-latest</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v2</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Fetch release version</span><span class="w"></span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">          </span><span class="no">echo &quot;Hello world !&quot;</span><span class="w"></span>
</code></pre></div>
<h2 id="conclusion">Conclusion</h2>
<p>Après vous avoir montré qu'il était possible de provisionner ses propres agents <strong>Azure DevOps Services</strong> dans son SI, je réitère ma démonstration sur <strong>GitHub</strong>. L'usine logicielle change mais le concept fonctionne toujours.</p>
<p>C'est aussi l'occasion de comparer les forces et les faiblesses de chacun.</p>
<p><strong>GitHub</strong> est incontestablement le grand vainqueur avec :</p>
<ul>
<li>la multitude de <strong>webhooks</strong> disponible permettant d'implémenter des scénarii interactifs affectant l'écosystème environnant.</li>
<li>l'enregistrement des <strong>runners</strong> avec un jeton temporaire qui est bien plus sécurisé que le <strong>Personal Access Token</strong> d'<strong>Azure DevOps</strong>.</li>
</ul>
<p>Mais <strong>Azure DevOps</strong> n'a pas dit son dernier mot ! </p>
<h2 id="references">Références</h2>
<ul>
<li><a href="https://docs.github.com/en/rest/reference/meta">GitHub : Api Meta</a></li>
<li><a href="https://docs.github.com/en/rest/reference/actions">GitHub : Api Actions</a></li>
<li><a href="https://docs.github.com/en/rest/overview/other-authentication-methods#basic-authentication">GitHub : Basic Authentication</a></li>
<li><a href="https://docs.github.com/en/developers/webhooks-and-events/webhooks/webhook-events-and-payloads">GitHub : Webhook events and payloads</a></li>
<li><a href="https://github.com/philips-labs/terraform-aws-github-runner">Terraform module for scalable self hosted GitHub action runners</a></li>
</ul>
<h2 id="remerciements">Remerciements</h2>
<ul>
<li><a href="https://twitter.com/michael_maillot">Michael Maillot</a> : pour la relecture</li>
</ul>
<p><em>Rédigé par Philippe MORISSEAU, Publié le 21 Février 2022.</em></p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/morisseauphi" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/pmorisseau" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version": "S\u00e9lectionner la version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.bd41221c.min.js"></script>
      
        <script src="../../../assets/javascripts/mmrls.js"></script>
      
    
  </body>
</html>